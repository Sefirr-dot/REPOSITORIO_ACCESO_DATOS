package datos;

import java.io.File;
import java.io.IOException;
import java.io.RandomAccessFile;
import java.util.Scanner;

public class Main {

	static final int POSICIONALUMNOS = 92;
	static final int POSICIONNOTAS = 48;
	public static void main(String[] args) throws IOException {

		Scanner sc = new Scanner(System.in);

		int opcion;
		do {
			mostrarMenu();
			opcion = sc.nextInt();
			switch(opcion) {
			case 1:
				listarAlumnos();
				break;
			case 2:
				listarNotas();
				break;
			case 3:
				actualizarFicheroAlumnos();
				break;
			case 4:
				break;
			case 5:
				System.out.println("Adios!!!");
				break;
			default:
				System.out.println("Elige una opcion valida Ma g");
			}
		} while(opcion !=0);
		sc.close();
	}

	private static void actualizarFicheroAlumnos() throws IOException {
		File archivo1 = new File(".\\Alumnos.dat");
		RandomAccessFile archAccessFile1 = new RandomAccessFile(archivo1, "rw");
		File archivo2 = new File(".\\Notas.dat");
		RandomAccessFile archAccessFile2 = new RandomAccessFile(archivo2, "rw");
		float salario =0;
		char nombre[] = new char[20],auxnombre;
		char nombreAlumno[] = new char[20], auxLocalidad;
		long posicion1 = 0;
		
		while(archAccessFile1.getFilePointer() != archAccessFile1.length()) {
			long posicion2 = 0;
			int contador = 0;
			float notaMediaFinal=0;
			archAccessFile1.seek(posicion1);
			archAccessFile2.seek(posicion2);
			int numAlumno = archAccessFile1.readInt();
			
			while (archAccessFile2.getFilePointer() != archAccessFile2.length()) {
				int numAlumno2 = archAccessFile2.readInt();
				if(numAlumno==numAlumno2) {
					System.out.println("Hpla");
					archAccessFile2.seek(posicion2);
					float notaMedia = archAccessFile2.readFloat();
					notaMediaFinal += notaMedia;
					contador++;
					
					}
				posicion2+=POSICIONNOTAS;
				notaMediaFinal = notaMediaFinal/contador;
				} 
		}
		archAccessFile1.seek(88+posicion1);	
		posicion1+=POSICIONALUMNOS;
						
		}
		

	private static void listarNotas() throws IOException {
		File archivo = new File(".\\Notas.dat");
		RandomAccessFile archAccessFile = new RandomAccessFile(archivo, "r");
		int posicion = 0;
		int registro=1;
		char nombreAsignatura[]= new char[20], auxNombreasignatura;
		System.out.println("REGIS     NUMALUM   ASIGNATURA           NOTAMEDIA");
		System.out.println("--------- --------- -------------------- ---------");
		while(archAccessFile.getFilePointer() != archAccessFile.length()) {
			archAccessFile.seek(posicion);
			int numAlumno = archAccessFile.readInt();
			if(numAlumno!=0) {
				
				for (int i = 0; i < nombreAsignatura.length; i++) {
					auxNombreasignatura = archAccessFile.readChar();
					nombreAsignatura[i] = auxNombreasignatura;
				}
				
				String nombreString = new String(nombreAsignatura);

				float notaAsignatura = archAccessFile.readFloat();
				
				System.out.printf("%-9d %-9s %-20s %-10.2f%n",registro ,numAlumno, nombreString.trim(), notaAsignatura);
				
			}
			registro++;
			
			posicion+=POSICIONNOTAS;
		
	}
		System.out.println("--------------------------------------------------");
}

	private static void listarAlumnos() throws IOException {
		File archivo = new File(".\\Alumnos.dat");
		RandomAccessFile archAccessFile = new RandomAccessFile(archivo, "r");
		float salario =0;
		char nombre[] = new char[20],auxnombre;
		
		char localidad[] = new char[20], auxLocalidad;
		long posicion = 0;
		System.out.println("NUMALUMNO NOMBRE               LOCALIDAD            NUMASIG NOTAMEDIA");
		System.out.println("--------- -------------------- -------------------- ------- ---------");
		while(archAccessFile.getFilePointer() != archAccessFile.length()) {
			archAccessFile.seek(posicion);
			int numAlumno = archAccessFile.readInt();
			if(numAlumno!=0) {
				for (int i = 0; i < nombre.length; i++) {
					auxnombre = archAccessFile.readChar();
					nombre[i] = auxnombre;
				}
				
				String nombreString = new String(nombre);
				for (int i = 0; i < localidad.length; i++) {
					auxLocalidad = archAccessFile.readChar();
					localidad[i] = auxLocalidad;
				}
				String localidadString = new String(localidad);
				int numAsignaturas = archAccessFile.readInt();
				float notaMedia = archAccessFile.readFloat();
				
				System.out.printf("%-9d %-20s %-20s %-7d %-10.2f%n", numAlumno, nombreString.trim(), localidadString.trim(), numAsignaturas, notaMedia);
				
			}
			
			posicion+=POSICIONALUMNOS;
		}		
		System.out.println("---------------------------------------------------------------------");
	}

	private static void mostrarMenu() {
		System.out.println("--------------------------------------");
		System.out.println("---------1.LISTAR ALUMNOS-------------");
		System.out.println("---------2.LISTAR NOTAS---------------");
		System.out.println("---------3.ACTUALIZAR FICHERO ALUMNOS-");
		System.out.println("---------4.GENERAR FICHERO alumnos.XML");
		System.out.println("---------5.SALIR----------------------");
	}
	
	

}
